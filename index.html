<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kasir Nyeblak Kuy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        /* Print-specific styles */
        @media print {
            body * {
                visibility: hidden;
            }
            #receipt-print-area, #receipt-print-area * {
                visibility: visible;
            }
            #receipt-print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            @page {
                size: 80mm auto; /* Adjust for 80mm thermal printer */
                margin: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white antialiased">

    <!-- Main Container -->
    <div class="flex flex-col lg:flex-row h-screen">

        <!-- Left Panel: Menu & Categories -->
        <div class="w-full lg:w-3/5 p-4 flex flex-col">
            <header class="mb-4">
                <h1 class="text-3xl font-bold text-red-400">Nyeblak Kuy</h1>
                <p class="text-gray-400">Pilih menu untuk ditambahkan ke pesanan</p>
            </header>
            
            <!-- Category Tabs -->
            <div class="flex space-x-2 mb-4 border-b border-gray-700">
                <button onclick="filterMenu('semua')" class="category-tab active-tab py-2 px-4 text-gray-300 font-semibold focus:outline-none">Semua</button>
                <button onclick="filterMenu('paket')" class="category-tab py-2 px-4 text-gray-300 font-semibold focus:outline-none">Paket Seblak</button>
                <button onclick="filterMenu('topping')" class="category-tab py-2 px-4 text-gray-300 font-semibold focus:outline-none">Topping</button>
                <button onclick="filterMenu('minuman')" class="category-tab py-2 px-4 text-gray-300 font-semibold focus:outline-none">Minuman</button>
            </div>

            <!-- Menu Grid -->
            <div id="menu-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 overflow-y-auto flex-grow">
                <!-- Menu items will be injected here by JavaScript -->
            </div>
        </div>

        <!-- Right Panel: Current Order -->
        <div class="w-full lg:w-2/5 bg-gray-800 p-6 flex flex-col shadow-lg">
            <h2 class="text-2xl font-bold mb-4">Pesanan Saat Ini</h2>
            
            <!-- Order Items List -->
            <div id="order-list" class="flex-grow overflow-y-auto pr-2">
                <p id="empty-cart-message" class="text-gray-400 text-center mt-10">Keranjang masih kosong.</p>
                <!-- Order items will be injected here -->
            </div>
            
            <!-- Order Summary -->
            <div class="border-t-2 border-gray-700 pt-4 mt-4">
                <div class="flex justify-between text-lg mb-2">
                    <span class="text-gray-400">Subtotal</span>
                    <span id="subtotal" class="font-semibold">Rp 0</span>
                </div>
                <div class="flex justify-between text-lg mb-2">
                    <span class="text-gray-400">Pajak (10%)</span>
                    <span id="tax" class="font-semibold">Rp 0</span>
                </div>
                <div class="flex justify-between text-2xl font-bold text-red-400 mb-4">
                    <span>Total</span>
                    <span id="total">Rp 0</span>
                </div>
                
                <!-- Action Buttons -->
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="clearCart()" class="w-full bg-red-700 hover:bg-red-800 rounded-lg py-3 font-bold transition-colors">Batal</button>
                    <button onclick="showPaymentModal()" id="pay-button" class="w-full bg-green-600 hover:bg-green-700 rounded-lg py-3 font-bold transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed" disabled>Bayar</button>
                </div>
                 <button onclick="showHistoryModal()" class="w-full mt-4 bg-blue-600 hover:bg-blue-700 rounded-lg py-3 font-bold transition-colors">Riwayat Transaksi</button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="payment-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 rounded-lg p-8 w-full max-w-md shadow-xl">
            <h3 class="text-2xl font-bold mb-6 text-center">Pembayaran</h3>
            <div class="mb-4">
                <label class="block text-gray-400 mb-2">Total Tagihan</label>
                <input type="text" id="total-tagihan" class="w-full bg-gray-700 rounded-md p-3 text-xl font-bold text-right" readonly>
            </div>
            <div class="mb-6">
                <label for="uang-diterima" class="block text-gray-400 mb-2">Uang Diterima</label>
                <input type="number" id="uang-diterima" class="w-full bg-gray-700 rounded-md p-3 text-xl font-bold text-right" placeholder="0">
            </div>
            <div class="flex justify-between items-center text-xl mb-6">
                <span class="text-gray-400">Kembalian</span>
                <span id="kembalian" class="font-bold text-green-400">Rp 0</span>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="closePaymentModal()" class="bg-gray-600 hover:bg-gray-700 rounded-lg py-3 font-bold transition-colors">Tutup</button>
                <button onclick="processPayment()" id="confirm-payment-button" class="bg-green-600 hover:bg-green-700 rounded-lg py-3 font-bold transition-colors disabled:bg-gray-600" disabled>Konfirmasi Bayar</button>
            </div>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div id="receipt-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
        <div class="bg-white text-gray-900 rounded-lg p-6 w-full max-w-sm">
            <div id="receipt-print-area" class="p-2">
                <!-- Receipt content will be injected here -->
            </div>
            <div class="mt-6 flex justify-between">
                <button onclick="closeReceiptModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">Tutup</button>
                <button onclick="printReceipt()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Cetak Nota</button>
            </div>
        </div>
    </div>
    
    <!-- History Modal -->
    <div id="history-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
        <div class="bg-gray-800 rounded-lg p-8 w-full max-w-2xl shadow-xl flex flex-col" style="height: 80vh;">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold">Riwayat Transaksi Hari Ini</h3>
                <button onclick="closeHistoryModal()" class="text-2xl">&times;</button>
            </div>
            <div id="history-list" class="flex-grow overflow-y-auto">
                <!-- History items will be injected here -->
            </div>
        </div>
    </div>


    <script>
        // --- DATABASE MENU ---
        // Anda bisa dengan mudah mengubah, menambah, atau menghapus menu di sini.
        const menuItems = [
            { id: 1, name: 'Seblak Original', price: 15000, category: 'paket', image: 'https://placehold.co/300x300/ef4444/white?text=Seblak+Ori' },
            { id: 2, name: 'Seblak Ceker', price: 18000, category: 'paket', image: 'https://placehold.co/300x300/f97316/white?text=Seblak+Ceker' },
            { id: 3, name: 'Seblak Seafood', price: 22000, category: 'paket', image: 'https://placehold.co/300x300/84cc16/white?text=Seblak+Seafood' },
            { id: 4, name: 'Seblak Komplit', price: 25000, category: 'paket', image: 'https://placehold.co/300x300/10b981/white?text=Seblak+Komplit' },
            { id: 5, name: 'Kerupuk', price: 1000, category: 'topping', image: 'https://placehold.co/300x300/6366f1/white?text=Kerupuk' },
            { id: 6, name: 'Makaroni', price: 1000, category: 'topping', image: 'https://placehold.co/300x300/6366f1/white?text=Makaroni' },
            { id: 7, name: 'Sosis', price: 2000, category: 'topping', image: 'https://placehold.co/300x300/8b5cf6/white?text=Sosis' },
            { id: 8, name: 'Bakso', price: 2000, category: 'topping', image: 'https://placehold.co/300x300/8b5cf6/white?text=Bakso' },
            { id: 9, name: 'Ceker Ayam', price: 3000, category: 'topping', image: 'https://placehold.co/300x300/a855f7/white?text=Ceker' },
            { id: 10, name: 'Telur', price: 3000, category: 'topping', image: 'https://placehold.co/300x300/a855f7/white?text=Telur' },
            { id: 11, name: 'Es Teh Manis', price: 5000, category: 'minuman', image: 'https://placehold.co/300x300/3b82f6/white?text=Es+Teh' },
            { id: 12, name: 'Es Jeruk', price: 6000, category: 'minuman', image: 'https://placehold.co/300x300/22d3ee/white?text=Es+Jeruk' },
        ];

        // --- APLIKASI STATE ---
        let cart = [];
        let transactions = [];
        let currentFilter = 'semua';

        // --- DOM ELEMENTS ---
        const menuGrid = document.getElementById('menu-grid');
        const orderList = document.getElementById('order-list');
        const subtotalEl = document.getElementById('subtotal');
        const taxEl = document.getElementById('tax');
        const totalEl = document.getElementById('total');
        const payButton = document.getElementById('pay-button');
        const emptyCartMessage = document.getElementById('empty-cart-message');
        const paymentModal = document.getElementById('payment-modal');
        const totalTagihanInput = document.getElementById('total-tagihan');
        const uangDiterimaInput = document.getElementById('uang-diterima');
        const kembalianEl = document.getElementById('kembalian');
        const confirmPaymentButton = document.getElementById('confirm-payment-button');
        const receiptModal = document.getElementById('receipt-modal');
        const historyModal = document.getElementById('history-modal');
        
        // --- UTILITY FUNCTIONS ---
        const formatRupiah = (number) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);

        // --- RENDER FUNCTIONS ---
        function renderMenu() {
            menuGrid.innerHTML = '';
            const filteredItems = menuItems.filter(item => currentFilter === 'semua' || item.category === currentFilter);
            
            filteredItems.forEach(item => {
                const menuItemHTML = `
                    <div onclick="addToCart(${item.id})" class="bg-gray-800 rounded-lg p-3 flex flex-col items-center justify-center text-center cursor-pointer hover:bg-gray-700 transition-colors">
                        <img src="${item.image}" alt="${item.name}" class="w-24 h-24 object-cover rounded-md mb-2" onerror="this.onerror=null;this.src='https://placehold.co/300x300/ef4444/white?text=Error';">
                        <h3 class="font-semibold text-sm">${item.name}</h3>
                        <p class="text-red-400 font-bold">${formatRupiah(item.price)}</p>
                    </div>
                `;
                menuGrid.innerHTML += menuItemHTML;
            });
        }

        function renderCart() {
            orderList.innerHTML = '';
            if (cart.length === 0) {
                emptyCartMessage.style.display = 'block';
                payButton.disabled = true;
            } else {
                emptyCartMessage.style.display = 'none';
                payButton.disabled = false;
                cart.forEach(item => {
                    const orderItemHTML = `
                        <div class="flex items-center mb-3 bg-gray-700 p-2 rounded-lg">
                            <div class="flex-grow">
                                <p class="font-semibold">${item.name}</p>
                                <p class="text-sm text-gray-400">${formatRupiah(item.price)}</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <button onclick="updateQuantity(${item.id}, -1)" class="w-7 h-7 bg-gray-600 rounded-full font-bold">-</button>
                                <span class="w-8 text-center font-semibold">${item.quantity}</span>
                                <button onclick="updateQuantity(${item.id}, 1)" class="w-7 h-7 bg-red-500 rounded-full font-bold">+</button>
                            </div>
                            <p class="w-24 text-right font-semibold">${formatRupiah(item.price * item.quantity)}</p>
                        </div>
                    `;
                    orderList.innerHTML += orderItemHTML;
                });
            }
            updateSummary();
        }

        function updateSummary() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * 0.10;
            const total = subtotal + tax;
            
            subtotalEl.textContent = formatRupiah(subtotal);
            taxEl.textContent = formatRupiah(tax);
            totalEl.textContent = formatRupiah(total);
        }

        // --- CART LOGIC ---
        function addToCart(itemId) {
            const existingItem = cart.find(item => item.id === itemId);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                const itemToAdd = menuItems.find(item => item.id === itemId);
                cart.push({ ...itemToAdd, quantity: 1 });
            }
            renderCart();
        }

        function updateQuantity(itemId, change) {
            const itemInCart = cart.find(item => item.id === itemId);
            if (itemInCart) {
                itemInCart.quantity += change;
                if (itemInCart.quantity <= 0) {
                    cart = cart.filter(item => item.id !== itemId);
                }
            }
            renderCart();
        }

        function clearCart() {
            cart = [];
            renderCart();
        }
        
        // --- MODAL LOGIC ---
        function showPaymentModal() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0) * 1.10;
            totalTagihanInput.value = formatRupiah(total);
            uangDiterimaInput.value = '';
            kembalianEl.textContent = formatRupiah(0);
            paymentModal.classList.remove('hidden');
            uangDiterimaInput.focus();
        }

        function closePaymentModal() {
            paymentModal.classList.add('hidden');
        }
        
        function showReceiptModal() {
            receiptModal.classList.remove('hidden');
        }

        function closeReceiptModal() {
            receiptModal.classList.add('hidden');
        }
        
        function showHistoryModal() {
            renderHistory();
            historyModal.classList.remove('hidden');
        }

        function closeHistoryModal() {
            historyModal.classList.add('hidden');
        }

        // --- PAYMENT & RECEIPT LOGIC ---
        uangDiterimaInput.addEventListener('input', () => {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0) * 1.10;
            const diterima = parseFloat(uangDiterimaInput.value) || 0;
            const kembalian = diterima - total;
            
            if (kembalian >= 0) {
                kembalianEl.textContent = formatRupiah(kembalian);
                confirmPaymentButton.disabled = false;
            } else {
                kembalianEl.textContent = formatRupiah(0);
                confirmPaymentButton.disabled = true;
            }
        });

        function processPayment() {
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0) * 1.10;
            const diterima = parseFloat(uangDiterimaInput.value);
            const kembalian = diterima - total;

            const transaction = {
                id: Date.now(),
                items: [...cart],
                total: total,
                paid: diterima,
                change: kembalian,
                date: new Date().toISOString()
            };
            
            transactions.push(transaction);
            saveTransactions();

            generateReceipt(transaction);
            showReceiptModal();
            closePaymentModal();
            clearCart();
        }
        
        function generateReceipt(transaction) {
            const receiptContentEl = document.getElementById('receipt-print-area');
            const date = new Date(transaction.date);
            const formattedDate = `${date.toLocaleDateString('id-ID')} ${date.toLocaleTimeString('id-ID')}`;

            let itemsHTML = transaction.items.map(item => `
                <tr>
                    <td class="py-1">${item.name}</td>
                    <td class="text-center">${item.quantity}</td>
                    <td class="text-right">${formatRupiah(item.price * item.quantity)}</td>
                </tr>
            `).join('');

            receiptContentEl.innerHTML = `
                <div style="font-family: 'Courier New', monospace; font-size: 12px; color: #000;">
                    <h3 style="text-align: center; font-size: 16px; margin-bottom: 8px;">Nyeblak Kuy</h3>
                    <p style="text-align: center; margin-bottom: 12px; font-size: 10px;">Jl. Terminal Wonosobo No.184, Perum Purnamandala, Bumireso, Kec. Wonosobo, Kab. Wonosobo, Jawa Tengah 56351</p>
                    <p>No: ${transaction.id}</p>
                    <p>Tanggal: ${formattedDate}</p>
                    <hr style="border-top: 1px dashed #000; margin: 8px 0;">
                    <table style="width: 100%;">
                        <thead>
                            <tr>
                                <th class="text-left py-1">Item</th>
                                <th class="text-center">Jml</th>
                                <th class="text-right">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsHTML}
                        </tbody>
                    </table>
                    <hr style="border-top: 1px dashed #000; margin: 8px 0;">
                    <table style="width: 100%;">
                        <tr><td>Subtotal:</td><td style="text-align: right;">${formatRupiah(transaction.total / 1.1)}</td></tr>
                        <tr><td>Pajak (10%):</td><td style="text-align: right;">${formatRupiah(transaction.total - (transaction.total / 1.1))}</td></tr>
                        <tr><td style="font-weight: bold;">Total:</td><td style="text-align: right; font-weight: bold;">${formatRupiah(transaction.total)}</td></tr>
                        <tr><td>Bayar:</td><td style="text-align: right;">${formatRupiah(transaction.paid)}</td></tr>
                        <tr><td>Kembali:</td><td style="text-align: right;">${formatRupiah(transaction.change)}</td></tr>
                    </table>
                    <p style="text-align: center; margin-top: 16px;">Terima kasih!</p>
                </div>
            `;
        }
        
        function printReceipt() {
            window.print();
        }
        
        // --- HISTORY LOGIC ---
        function renderHistory() {
            const historyListEl = document.getElementById('history-list');
            historyListEl.innerHTML = '';
            if (transactions.length === 0) {
                 historyListEl.innerHTML = '<p class="text-gray-400 text-center">Belum ada transaksi hari ini.</p>';
                 return;
            }
            
            // Show latest first
            [...transactions].reverse().forEach(tx => {
                const date = new Date(tx.date);
                const itemsSummary = tx.items.map(i => `${i.quantity}x ${i.name}`).join(', ');
                const historyItemHTML = `
                    <div class="bg-gray-700 p-4 rounded-lg mb-3">
                        <div class="flex justify-between items-center">
                            <div>
                                <p class="font-bold">Transaksi #${tx.id}</p>
                                <p class="text-sm text-gray-400">${date.toLocaleTimeString('id-ID')}</p>
                            </div>
                            <p class="font-bold text-lg text-red-400">${formatRupiah(tx.total)}</p>
                        </div>
                        <p class="text-sm mt-2 text-gray-300">${itemsSummary}</p>
                    </div>
                `;
                historyListEl.innerHTML += historyItemHTML;
            });
        }

        // --- DATA PERSISTENCE (LocalStorage) ---
        function saveTransactions() {
            localStorage.setItem('seblakTransactions', JSON.stringify(transactions));
        }

        function loadTransactions() {
            const saved = localStorage.getItem('seblakTransactions');
            if (saved) {
                transactions = JSON.parse(saved);
                // Simple logic to clear transactions for a new day
                if (transactions.length > 0) {
                    const lastDate = new Date(transactions[transactions.length - 1].date);
                    const today = new Date();
                    if (lastDate.toDateString() !== today.toDateString()) {
                        transactions = []; // It's a new day, clear history
                        saveTransactions();
                    }
                }
            }
        }

        // --- FILTER & INITIALIZATION ---
        function filterMenu(category) {
            currentFilter = category;
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active-tab', 'text-red-400', 'border-b-2', 'border-red-400');
                if(tab.textContent.toLowerCase().includes(category)) {
                    tab.classList.add('active-tab', 'text-red-400', 'border-b-2', 'border-red-400');
                }
            });
            renderMenu();
        }

        // --- ON PAGE LOAD ---
        document.addEventListener('DOMContentLoaded', () => {
            loadTransactions();
            renderMenu();
            renderCart();
            filterMenu('semua'); // Set default filter
        });
    </script>
</body>
</html>
